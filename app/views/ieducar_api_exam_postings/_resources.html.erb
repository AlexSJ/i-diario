<tbody>
  <% ApiPostingTypes.to_a.each do |value| %>
    <% next if value.last == ApiPostingTypes::FINAL_RECOVERY && step != step.school_calendar.steps.to_a.last %>

    <tr>
      <td>
        <%= value.first %>
      </td>

      <td>
        <% api_posting = instance_variable_get("@school_calendar_step_#{step.id}_#{value.last}_posting") %>
        <% if api_posting %>
          <% if api_posting.status == ApiPostingStatus::STARTED %>
            <i class="fa fa-cog fa-spin"></i> Enviando
            <% if worker_batch = api_posting.worker_batch %>
              (<span class='ieducar-posting-done-percentage' data-url='<%= done_percentage_ieducar_api_exam_posting_pt_br_path(api_posting.id) %>'><%= worker_batch.done_percentage %></span>%)
            <% end %>
          <% else %>
            <% if api_posting.message.present? %>
              <p class="success">
                <i class="fa fa-check"></i>
                <%= api_posting.message %>
              </p>
            <% end %>

            <% if api_posting.error_message.present? %>
              <p class="danger">
                <i class="fa fa-times"></i>
                <%= current_user.admin? && api_posting.full_error_message.present? ? api_posting.full_error_message : api_posting.error_message %>
              </p>
            <% end %>

            <% if api_posting.warning_message.present? %>
            <% api_posting.warning_message.each do |message| %>
              <p class="warning">
                <i class="fa fa-exclamation-triangle"></i>
                  <%= message %>
              </p>
              <% end %>
            <% end %>
          <% end %>
        <% else %>
          <i>Nenhuma postagem realizada</i>
        <% end %>
      </td>

      <td>
        <% if api_posting && api_posting.synchronization_in_progress? %>
            <%= link_to 'Enviar', '#', class: 'btn bg-color-red txt-color-white disabled' %>
        <% else %>
          <%= link_to 'Enviar', ieducar_api_exam_postings_path(school_calendar_step_id: step.id, post_type: value.last),
                                method: 'post',
                                class: 'btn bg-color-red txt-color-white' %>
        <% end %>
      </td>
    </tr>
  <% end %>
</tbody>
